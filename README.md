# gmusic2spotify

gmusic2spotify is a collection of scripts used to migrate songs and playlists from Google Play Music to Spotify.

## Prerequisites

gmusic2spotify requires a Python 3 installation as well as pip.

## Usage

- Clone the repo with `git clone https://github.com/caseif/gmusic2spotify.py`
- Install Python dependencies with `pip install -r requirements.txt`
- If using two-factor authentication for Google, [create an app-specific password](https://support.google.com/accounts/answer/185833?hl=en)
- [Register a new app with Spotify](https://developer.spotify.com/documentation/general/guides/app-settings/#register-your-app)
  - The name doesn't matter
  - Add `http://localhost:8000` to the "Redirect URIs" field
  - Take note of the Client ID and Client Secret; these are used for authentication later on
- Run `python3 gmusic2json.py` (or just `./gmusic2json`) to export your Google Play Music library
  - If this does not complete successfully, the next step will not work
- Run `python3 json2spotify.py` (or just `./json2spotify.py`) to import the library to Spotify
  - Enter your username and the client ID and secret you created earlier
  - A browser tab should open requesting access to your library, simply click the button to grant access

### Notes

`json2spotify.py`, when run, will generate a file called `spotify_mappings.csv` which will be used should you run the
script again. If you wish to generate the mappings again, delete this file.

`json2spotify.py` will also generate a file called `unmached.json`, containing songs which could not be matched as well
as any playlists they are present in.

## Limitations

Due to limitations of the Spotify API, this suite is not capable of automating the process of uploading custom music,
nor can it interact with user-uploaded tracks in any way. As far as I can tell, there is no way around this.

While `json2spotify.py` is generally _very_ good at matching tracks, it will occasionally goof up and you'll find a
"rogue" track in your library. Typically this occurs when a track is not available on Spotify, but one with a similar
title and artist is. It can also occur due to discrepancies in how tracks are titled across platforms.

## Components

### gmusic2json.py

Exports a library from Google Play Music to a local JSON file (`output_library.json`). Very straightforward.

Note that the UUIDs are not guaranteed to be of any particular significance (although they often correspond to IDs on
Google Play Music).

### json2spotify.py

Imports a library from a local JSON file to Spotify. It does this in two steps:

First, it attempts to match songs to their counterparts on Spotify. This occurs in three passes:

- It passes the track title and artist as-is as search parameters, then looks for a valid result
- It transforms the track title and artist, removing common cross-platform discrepancies, then passes them as search
  parameters and looks for a valid result
- It passes only the transformed title as a search parameter, then looks for a valid result

Employing all three heuristics allows the script to match as many tracks as possible, as certain heuristics are more
effective than others depending on the specific case. Unfortunately, Spotify search is incredibly slow, so we sacrifice
speed for effectiveness by doing this.

In all three cases, the script employs a fuzzy-matching heuristic to determine which result is closest to the goal,
taking artist, title, and album into account. Because a track can have multiple artists, it uses the maximum score of
all artists listed in the result from Spotify.

### spotify_auth.py

Helper script to make the authorization process with Spotify a little less painful. This script initializes a local web
server, initiates an authorization request, then intercepts the GET request generated by the authentication redirect in
the opened browser tab. This allows the process to be mostly automated, removing any need for copy-pasting.

### clear_spotify_library.py

Removes all tracks and playlists from a Spotify library. Useful for testing.

## License

All code in the gmusic2spotify suite is available under the MIT license.

## Contributing

Pull requests are welcome, but be wary that tweaking the matching heurstics in `json2spotify.py` can adversely affect
effectiveness depending on specific case. Please be mindful of this when adjusting them.
